package main

import (
	"context"
	"fmt"
	"log"
	"time"

	agk "github.com/agenticgokit/agenticgokit/v1beta"
)

func main() {
	ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)
	defer cancel()

	// Create a simple agent with hardcoded configuration
	agent, err := agk.QuickChatAgentWithConfig("assistant", &agk.Config{
		Name:         "quickstart-agent",
		SystemPrompt: "You are a helpful AI assistant. Provide clear, concise answers.",
		Timeout:      30 * time.Second,
		LLM: agk.LLMConfig{
			Provider:    "{{.LLMProvider}}",
			Model:       "{{.LLMModel}}",
			Temperature: 0.7,
			MaxTokens:   1000,
		},
	})
	if err != nil {
		log.Fatalf("Failed to create agent: %v", err)
	}

	// Simple conversation
	userMessage := "What is AgenticGoKit?"

	fmt.Printf("User: %s\n\n", userMessage)
	fmt.Println("Assistant:")

	// Use streaming for real-time response
	stream, err := agent.RunStream(ctx, userMessage)
	if err != nil {
		log.Fatalf("Failed to start streaming: %v", err)
	}

	printStreamingResponse(stream)
}

// printStreamingResponse prints the streaming response as tokens arrive
func printStreamingResponse(stream agk.Stream) {
	for chunk := range stream.Chunks() {
		if chunk.Error != nil {
			fmt.Printf("\n❌ Error: %v\n", chunk.Error)
			break
		}

		switch chunk.Type {
		case agk.ChunkTypeDelta:
			fmt.Print(chunk.Delta)
		case agk.ChunkTypeDone:
			fmt.Println("\n\n✅ Completed")
		}
	}
}
